parameters:
  PackagePath: "not-specified"
  PackageName: "not-specfied"
  ReleaseName: "not-specified"
  ReleaseNotes: "not-specfied"

steps:
  - pwsh: |
      $currentVersion = node -p -e "require('./packages/${{ parameters.PackagePath }}/package.json').version";
      cd packages/${{ parameters.PackagePath }}
      npm version --no-git-tag-version $currentVersion
      npm pack
      npm install -g ${{ parameters.PackageName }}-$currentVersion.tgz
      if ($LASTEXITCODE) {
        exit $LASTEXITCODE
      }
      npx publish-release `
        --token $(azuresdk-github-pat) `
        --repo autorest.go `
        --owner azure `
        --name "${{ parameters.ReleaseName }}" `
        --tag v$currentVersion `
        --notes='${{ parameters.ReleaseNotes }}' `
        --prerelease `
        --editRelease false `
        --assets ${{ parameters.PackageName }}-$currentVersion.tgz `
        --target_commitish $(Build.SourceBranchName);
    displayName: "Publish GitHub Release ${{ parameters.PackagePath }}"

  - script: |
      cd packages/${{ parameters.PackagePath }}
      echo "//registry.npmjs.org/:_authToken=$(azure-sdk-npm-token)" > ./.npmrc
      npm publish --access public
    displayName: "Publish to npm ${{ parameters.PackagePath }}"
