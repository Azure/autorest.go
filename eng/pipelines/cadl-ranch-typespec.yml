trigger:
  branches:
    include:
      - main
  paths:
    include:
      - packages/typespec-go/test/cadlranch
pr: none

steps:
  - template: ../steps/set-env.yaml
    parameters:
      NodeVersion: "18.x"
      GoVersion: "$(go.version)"

  - template: ../steps/build-test-typespec.yaml

  - task: AzureCLI@2
    displayName: Upload CADL Ranch Test Coverage
    inputs:
      azureSubscription: "Cadl Ranch Storage"
      scriptType: "bash"
      scriptLocation: "inlineScript"
      inlineScript: cadl-ranch upload-coverage --generatorName go --storageAccountName azuresdkcadlranch --generatorVersion $(node -p -e "require('$(System.DefaultWorkingDirectory)/packages/typespec-go/package.json').version")
      workingDirectory: $(System.DefaultWorkingDirectory)/packages/typespec-go/node_modules/@azure-tools/cadl-ranch-specs
